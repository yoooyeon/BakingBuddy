<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
</head>
<body>
<div class="container" style="max-width: 600px; margin-top: 50px;">
    <h2 class="text-center">로그인</h2>
    <form id="loginForm" onsubmit="event.preventDefault(); login();">
        <div class="mb-3">
            <label for="username" class="form-label">사용자명</label>
            <input type="text" class="form-control" id="username" name="username" placeholder="사용자명을 입력하세요" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">비밀번호</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력하세요"
                   required>
        </div>
        <button type="submit" class="btn btn-primary">로그인</button>
    </form>
</div>
<script>
    // 로그인 요청 후 토큰 저장하는 함수
    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({"username": username, "password": password})
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                if (data.token) {
                    // 토큰을 localStorage에 저장
                    localStorage.setItem('token', data.token);
                    console.log('Token stored in localStorage:', data.token);
                    // 로그인 후 홈페이지로 리다이렉트
                    window.location.href = "/";  // 홈페이지로 이동
                } else {
                    console.error('No token received:', data);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // 오류 발생 시 사용자에게 알림을 추가할 수 있음
                alert('로그인을 실패했습니다. 다시 시도해 주세요.');
            });
    }


    // 페이지 로드 시 최초 한 번 로그인 상태 확인
    document.addEventListener('DOMContentLoaded', function () {
        const token = localStorage.getItem('token');
        if (token) {
            // // 토큰이 있으면 홈페이지로 리다이렉트
            // window.location.href = "/";
        }
    });
</script>
</body>
</html>
